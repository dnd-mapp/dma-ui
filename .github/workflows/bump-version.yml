name: Bump version
permissions:
    contents: write
    pull-requests: write
on:
    workflow_dispatch:
        inputs:
            version:
                required: true
                description: What kind of release is this going to be?
                type: choice
                options:
                    - major
                    - minor
                    - patch
jobs:
    bump-version:
        name: Bump version
        runs-on: ubuntu-22.04
        steps:
            - name: Checkout repository
              uses: actions/checkout@v4
            - name: Set up Node.js
              uses: ./.github/actions/setup-node
            - name: Configure Git
              run: |
                  git config user.name "GitHub Actions"
                  git config user.email "actions@github.com"
            - name: Bump version
              run: npm version ${{ inputs.version }} -w packages/dma-ui
            - name: Extract version
              run: |
                  VERSION=$(jq -r '.version' packages/dma-ui/package.json)
                  echo "VERSION=$VERSION" >> $GITHUB_ENV
            - name: Create branch
              run: git checkout -b release/${{ env.VERSION }}
            - name: Commit changes
              run: |
                  git add .
                  git commit -m "Bump version to ${{ env.VERSION }}"
            - name: Push changes
              run: git push origin release/${{ env.VERSION }}
            - name: Create Pull request
              uses: peter-evans/create-pull-request@v7
              with:
                  base: main
                  branch: release/${{ env.VERSION }}
                  title: Release/${{ env.VERSION }}
                  body: Bumps the version to ${{ env.VERSION }}
                  committer: GitHub Actions <actions@github.com>
                  author: GitHub Actions <actions@github.com>
